<!DOCTYPE html>
<html lang="es">
<head>
    <!-- 
        Chosen Palette: Neon/Synthwave (Dark blue background with cyan and magenta glows)
        Application Structure Plan: A three-stage, single-page application flow. 1) A "Start Screen" to introduce the game. 2) A "Game Screen" that displays the four challenge elements in a 2x2 responsive grid, with action buttons below. 3) A "Solution" area that is dynamically populated based on user choices. This structure directly mirrors the user journey described in the source document, making the flow intuitive and focused. The use of progressive disclosure (hiding solutions until requested) prevents information overload.
        Visualization & Content Choices: Challenge elements are presented in styled HTML 'card' divs for clear visual separation. Solutions are dynamically generated text blocks. AI interaction is handled via button clicks that trigger JavaScript fetch calls to the Gemini API, with a loading spinner for user feedback. Sound effects are generated with Tone.js to create an immersive, digital-native experience without external assets, as requested in the source document.
        CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reto Creativo Interactivo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --glow-color: #00ffff;
            --secondary-glow: #ff00ff;
        }
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #111827;
            color: #e5e7eb;
            overflow-x: hidden;
        }
        .font-orbitron {
            font-family: 'Orbitron', sans-serif;
        }
        .neon-text {
            text-shadow:
                0 0 5px var(--glow-color),
                0 0 10px var(--glow-color),
                0 0 20px var(--glow-color),
                0 0 40px var(--glow-color);
        }
        .neon-button {
            border: 2px solid var(--glow-color);
            color: var(--glow-color);
            background-color: transparent;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px var(--glow-color), inset 0 0 10px var(--glow-color);
            text-shadow: 0 0 5px var(--glow-color);
        }
        .neon-button:hover {
            background-color: var(--glow-color);
            color: #111827;
            box-shadow: 0 0 20px var(--glow-color), 0 0 40px var(--glow-color);
        }
        .neon-button-secondary {
            border-color: var(--secondary-glow);
            color: var(--secondary-glow);
            box-shadow: 0 0 10px var(--secondary-glow), inset 0 0 10px var(--secondary-glow);
            text-shadow: 0 0 5px var(--secondary-glow);
        }
        .neon-button-secondary:hover {
            background-color: var(--secondary-glow);
            color: #111827;
            box-shadow: 0 0 20px var(--secondary-glow), 0 0 40px var(--secondary-glow);
        }
        .card {
            background-color: rgba(31, 41, 55, 0.5);
            border: 1px solid var(--glow-color);
            backdrop-filter: blur(10px);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--secondary-glow);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-4xl mx-auto">
        
        <div id="start-screen" class="text-center">
            <h1 class="text-5xl md:text-7xl font-orbitron font-bold neon-text mb-4">RETO CREATIVO</h1>
            <p class="text-lg md:text-xl text-gray-300 mb-8">Una herramienta de ideaci√≥n interactiva por N√∫cleo Colectivo</p>
            <button id="start-button" class="neon-button font-orbitron text-2xl py-3 px-8 rounded-lg">
                COMENZAR
            </button>
        </div>

        <div id="game-screen" class="hidden">
            <h2 class="text-4xl font-orbitron font-bold text-center mb-6" style="color: var(--glow-color); text-shadow: 0 0 10px var(--glow-color);">Tu Reto</h2>
            
            <div id="challenge-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            </div>

            <div id="solution-choices" class="flex flex-col md:flex-row justify-center gap-4 mb-8">
                <button id="standard-solution-btn" class="neon-button py-2 px-6 rounded-md">Ver Soluci√≥n Est√°ndar</button>
                <button id="ai-solution-btn" class="neon-button-secondary py-2 px-6 rounded-md">üß† Generar Soluci√≥n con IA</button>
            </div>
            
            <div id="loading-indicator" class="hidden flex-col items-center justify-center my-8">
                <div class="loader mb-4"></div>
                <p class="text-lg text-gray-400">La IA est√° procesando tu reto...</p>
            </div>

            <div id="solution-display" class="card rounded-lg p-6 hidden">
                <h3 id="solution-title" class="text-2xl font-orbitron font-bold mb-4"></h3>
                <div id="solution-content" class="text-gray-300 prose prose-invert max-w-none"></div>
            </div>

            <div id="expand-section" class="text-center mt-6 hidden">
                 <button id="expand-idea-btn" class="neon-button-secondary py-2 px-6 rounded-md">üöÄ Expandir Idea con IA</button>
            </div>

            <div class="text-center mt-8">
                <button id="reset-button" class="neon-button py-2 px-6 rounded-md hidden">Generar Nuevo Reto</button>
            </div>

        </div>
    </div>

    <script type="module">
        let audioReady = false;

        const clickSynth = new Tone.Synth({
            oscillator: { type: 'triangle' },
            envelope: { attack: 0.005, decay: 0.1, sustain: 0, release: 0.1 }
        }).toDestination();

        const startSynth = new Tone.FMSynth({
            harmonicity: 3,
            modulationIndex: 10,
            envelope: { attack: 0.2, decay: 0.5, sustain: 0, release: 0.8 }
        }).toDestination();

        const aiSynth = new Tone.AMSynth({
             harmonicity: 1.5,
             envelope: { attack: 0.01, decay: 0.5, sustain: 0.1, release: 0.5 },
             modulation: { type: 'sine' },
             modulationEnvelope: { attack: 0.5, decay: 0.2, sustain: 0, release: 0.5 }
        }).toDestination();
        
        const successSynth = new Tone.PolySynth(Tone.Synth, {
            envelope: { attack: 0.01, decay: 0.2, sustain: 0.2, release: 0.2 }
        }).toDestination();


        function playClickSound() {
            if (!audioReady) return;
            clickSynth.triggerAttackRelease('C5', '8n');
        }

        function playStartSound() {
            if (!audioReady) return;
            startSynth.triggerAttackRelease('C3', '2n');
        }
        
        function playAISound() {
            if (!audioReady) return;
            aiSynth.triggerAttackRelease('A2', '1n');
        }
        
        function playSuccessSound() {
            if (!audioReady) return;
            successSynth.triggerAttackRelease(['C4', 'E4', 'G4'], '4n');
        }

        async function initializeAudio() {
            if (!audioReady) {
                await Tone.start();
                audioReady = true;
                console.log("Audio context started.");
            }
        }

        const conceptos = ["Sostenibilidad Artesanal", "Innovaci√≥n Social Digital", "Educaci√≥n Inmersiva", "Salud Comunitaria Preventiva", "Cultura Urbana Regenerativa", "Turismo Experiencial Local"];
        const acciones = ["Organizar Talleres Comunitarios", "Desarrollar una Plataforma Digital", "Crear una Instalaci√≥n de Arte P√∫blico", "Lanzar una Campa√±a de Concienciaci√≥n", "Dise√±ar un Programa de Voluntariado", "Producir un Documental Interactivo"];
        const desafios = ["Falta de Recursos Econ√≥micos", "Desinter√©s Comunitario", "Barreras Tecnol√≥gicas", "Competencia con Grandes Corporaciones", "Regulaciones Gubernamentales Estrictas", "Impacto Ambiental Negativo"];
        const contextos = ["una Comunidad Rural Aislada", "un Centro Cultural Urbano", "una Escuela P√∫blica con Bajos Recursos", "un Mercado Local de Artesanos", "un Espacio Digital Descentralizado (Metaverso)", "un Parque Natural Protegido"];
        
        const emojis = {
            CONCEPTO: "üí°",
            ACCI√ìN: "üõ†Ô∏è",
            DESAF√çO: "üî•",
            CONTEXTO: "üåç"
        };
        
        const colors = {
            CONCEPTO: "#39a7ff", 
            ACCI√ìN: "#ff5733",
            DESAF√çO: "#ff1744",
            CONTEXTO: "#32cd32"
        };

        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const startButton = document.getElementById('start-button');
        const challengeContainer = document.getElementById('challenge-container');
        const solutionChoices = document.getElementById('solution-choices');
        const standardSolutionBtn = document.getElementById('standard-solution-btn');
        const aiSolutionBtn = document.getElementById('ai-solution-btn');
        const loadingIndicator = document.getElementById('loading-indicator');
        const solutionDisplay = document.getElementById('solution-display');
        const solutionTitle = document.getElementById('solution-title');
        const solutionContent = document.getElementById('solution-content');
        const expandSection = document.getElementById('expand-section');
        const expandIdeaBtn = document.getElementById('expand-idea-btn');
        const resetButton = document.getElementById('reset-button');

        let currentChallenge = {};
        let currentAiSolution = "";

        startButton.addEventListener('click', async () => {
            await initializeAudio();
            playStartSound();
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            resetButton.classList.remove('hidden');
            generateChallenge();
        });
        
        resetButton.addEventListener('click', () => {
             playClickSound();
             generateChallenge();
             solutionDisplay.classList.add('hidden');
             solutionChoices.classList.remove('hidden');
             expandSection.classList.add('hidden');
             currentAiSolution = "";
             solutionContent.innerHTML = "";
        });

        function generateChallenge() {
            challengeContainer.innerHTML = '';
            
            currentChallenge = {
                concepto: conceptos[Math.floor(Math.random() * conceptos.length)],
                accion: acciones[Math.floor(Math.random() * acciones.length)],
                desafio: desafios[Math.floor(Math.random() * desafios.length)],
                contexto: contextos[Math.floor(Math.random() * contextos.length)]
            };
            
            displayCard("CONCEPTO", currentChallenge.concepto);
            displayCard("ACCI√ìN", currentChallenge.accion);
            displayCard("DESAF√çO", currentChallenge.desafio);
            displayCard("CONTEXTO", currentChallenge.contexto);
        }

        function displayCard(title, text) {
            const card = document.createElement('div');
            card.className = 'card rounded-lg p-4 flex flex-col items-center text-center';
            card.style.borderColor = colors[title];
            card.innerHTML = `
                <h3 class="text-xl font-orbitron font-bold mb-2" style="color: ${colors[title]};">${emojis[title]} ${title}</h3>
                <p class="text-gray-300">${text}</p>
            `;
            challengeContainer.appendChild(card);
        }
        
        standardSolutionBtn.addEventListener('click', () => {
            playClickSound();
            expandSection.classList.add('hidden');
            solutionTitle.textContent = "Soluci√≥n Est√°ndar";
            solutionContent.innerHTML = `
                <p>Este es un punto de partida estructurado basado en tu reto:</p>
                <ul class="list-disc list-inside mt-2">
                    <li><strong>Fase 1: Investigaci√≥n.</strong> Analizar a fondo ${currentChallenge.contexto} y las causas del ${currentChallenge.desafio}.</li>
                    <li><strong>Fase 2: Ideaci√≥n.</strong> Realizar un taller de co-creaci√≥n con la comunidad para adaptar la acci√≥n de "${currentChallenge.accion}" al concepto de ${currentChallenge.concepto}.</li>
                    <li><strong>Fase 3: Prototipo.</strong> Desarrollar una versi√≥n de bajo costo de la soluci√≥n y probarla con un grupo peque√±o.</li>
                    <li><strong>Fase 4: B√∫squeda de Fondos.</strong> Con los resultados del prototipo, presentar el proyecto a ONGs, gobierno local o plataformas de crowdfunding.</li>
                </ul>
            `;
            solutionDisplay.classList.remove('hidden');
            solutionChoices.classList.add('hidden');
        });

        aiSolutionBtn.addEventListener('click', async () => {
            handleAiInteraction(false);
        });

        expandIdeaBtn.addEventListener('click', async () => {
            handleAiInteraction(true);
        });

        async function handleAiInteraction(isExpanding) {
            playAISound();
            loadingIndicator.classList.remove('hidden');
            
            if(isExpanding) {
                expandSection.classList.add('hidden');
            } else {
                solutionChoices.classList.add('hidden');
                solutionDisplay.classList.add('hidden');
            }

            const prompt = isExpanding 
                ? `Eres un estratega de proyectos para N√∫cleo Colectivo. Toma la siguiente idea y exp√°ndela.
                
                  Reto Original:
                  - Concepto: ${currentChallenge.concepto}
                  - Acci√≥n: ${currentChallenge.accion}
                  - Desaf√≠o: ${currentChallenge.desafio}
                  - Contexto: ${currentChallenge.contexto}
                  
                  Soluci√≥n Inicial de IA: "${currentAiSolution}"

                  Tu tarea es desarrollar esta idea con mayor profundidad. Responde usando Markdown y emojis. Cubre los siguientes puntos:
                  1.  **Posibles Colaboradores:** ¬øQu√© perfiles o entidades ser√≠an clave?
                  2.  **Recursos Necesarios:** ¬øQu√© se necesita para empezar?
                  3.  **M√©tricas de √âxito:** ¬øC√≥mo se medir√≠a el impacto?`
                : `Eres un experto en innovaci√≥n para N√∫cleo Colectivo. Genera una soluci√≥n creativa, concisa e inspiradora para el siguiente reto:
                
                   - Concepto Gu√≠a: ${currentChallenge.concepto}
                   - Acci√≥n Principal: ${currentChallenge.accion}
                   - Desaf√≠o a Superar: ${currentChallenge.desafio}
                   - Contexto Espec√≠fico: ${currentChallenge.contexto}

                   Genera la idea en un p√°rrafo.`;
            
            try {
                const resultText = await callGeminiAPI(prompt);
                
                if (!isExpanding) {
                    currentAiSolution = resultText;
                }

                solutionTitle.textContent = isExpanding ? "üöÄ Idea Expandida por IA" : "üß† Soluci√≥n Generada por IA";
                
                let htmlResult = resultText
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\n\s*-\s/g, '</li><li class="mt-1">')
                    .replace(/\n\s*\d\.\s/g, '</li><li class="mt-1">')
                    .replace(/\n/g, '<br>');

                if(htmlResult.includes('</li><li')){
                    htmlResult = '<ul class="list-none">' + htmlResult + '</ul>'.replace('<ul></li>','<ul>');
                }
                
                solutionContent.innerHTML = htmlResult;
                
                playSuccessSound();
                solutionDisplay.classList.remove('hidden');
                if(!isExpanding) {
                   expandSection.classList.remove('hidden');
                }

            } catch (error) {
                console.error("Error calling Gemini API:", error);
                solutionContent.textContent = "Hubo un error al contactar a la IA. Por favor, intenta de nuevo.";
                solutionDisplay.classList.remove('hidden');
                solutionChoices.classList.remove('hidden');
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        async function callGeminiAPI(prompt) {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ parts: [{ text: prompt }] }]
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`API call failed with status: ${response.status}`);
            }

            const result = await response.json();
            
            if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                return result.candidates[0].content.parts[0].text;
            } else {
                console.error("Unexpected API response structure:", result);
                if (result.promptFeedback?.blockReason) {
                    throw new Error(`Prompt was blocked: ${result.promptFeedback.blockReason}`);
                }
                throw new Error('No content received from API.');
            }
        }
    </script>
</body>
</html>
